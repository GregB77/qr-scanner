<!DOCTYPE html>
<html>
<head>
    <title>Scanner QR - Fichier Indépendant</title>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <style>
        #preview { width: 100%; max-width: 600px; }
        body { text-align: center; font-family: sans-serif; }
    </style>
</head>
<body>
    <h1>Scanner de QR Code</h1>
    <video id="preview"></video>
    <p>Données scannées : <span id="data"></span></p>

    <script>
        // REMPLACEZ CETTE URL PAR CELLE DE VOTRE APPLICATION WEB GOOGLE APPS SCRIPT
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby_o6iawqSqnl1-4omk3PU0QvdmzYwwrK9lWLoP_h3UMtvkcV0ncSimut5y5GYAl6SbbA/exec';

        let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
        scanner.addListener('scan', function (content) {
            document.getElementById('data').textContent = content;
            sendDataToGoogleSheet(content);
        });

        Instascan.Camera.getCameras().then(function (cameras) {
            if (cameras.length > 0) {
                // Détecte la caméra arrière par défaut si elle existe
                let backCamera = cameras.find(camera => camera.name.toLowerCase().includes('back') || camera.name.toLowerCase().includes('arrière') || camera.name.toLowerCase().includes('environment'));
                if (backCamera) {
                    scanner.start(backCamera);
                } else {
                    scanner.start(cameras[0]);
                    console.warn('Caméra arrière non trouvée, utilisation de la caméra par défaut.');
                }
            } else {
                console.error('Aucune caméra trouvée.');
            }
        }).catch(function (e) {
            console.error(e);
        });

        function sendDataToGoogleSheet(qrData) {
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ qrData: qrData }),
                headers: {
                    'Content-Type': 'text/plain' // Type de contenu est 'text/plain' pour Apps Script
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log('Données envoyées avec succès à Google Sheets.');
                } else {
                    console.error('Erreur lors de l’envoi des données.');
                }
            })
            .catch(error => {
                console.error('Erreur de connexion :', error);
            });
        }
    </script>
</body>
</html>
