<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Participants CCalor Run</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⏱️</text></svg>">
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9f9f9;
      color: #333;
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #2c3e50;
    }

    #search {
      display: block;
      margin: 10px auto 20px auto;
      padding: 8px 12px;
      width: 50%;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto 20px auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      background-color: #fff;
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      cursor: pointer;
    }

    th {
      background-color: #34495e;
      color: #ecf0f1;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 0.9rem;
    }

    tbody tr:nth-child(odd) { background-color: #ecf0f1; }
    tbody tr:nth-child(even) { background-color: #fff; }
    tbody tr:hover { background-color: #d1e7fd; transition: background-color 0.3s; }

    .pagination {
      text-align: center;
      margin-bottom: 30px;
    }
    .pagination button {
      padding: 5px 10px;
      margin: 0 3px;
      border: none;
      background-color: #34495e;
      color: #fff;
      border-radius: 3px;
      cursor: pointer;
    }
    .pagination button:disabled {
      background-color: #7f8c8d;
      cursor: default;
    }
  </style>
</head>
<body>
  <h2>Participants Calor Run</h2>
  <input type="text" id="search" placeholder="Rechercher...">
  <table id="data-table">
    <thead>
      <tr>
        <th data-column="Dossard">Dossard</th>
        <th data-column="Nom">Nom</th>
        <th data-column="Prenom">Prénom</th>
        <th data-column="Club">Club</th>
        <th data-column="Age">Age</th>
        <th data-column="HF">HF</th>
        <th data-column="CAT">CAT</th>
        <th data-column="Course">Course</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="pagination" id="pagination"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAIAAz51gEGKQd0EoqA3yUhvnqw3DkQiIo",
      authDomain: "calor-run.firebaseapp.com",
      databaseURL: "https://calor-run-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "calor-run",
      storageBucket: "calor-run.firebasestorage.app",
      messagingSenderId: "329949291334",
      appId: "1:329949291334:web:c71ef20268c609cf953b47",
      measurementId: "G-YVQPW6JGPK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, "participants");

    function formatExcelDate(excelDate) {
      const jsDate = new Date((excelDate - 25569) * 86400 * 1000);
      const day = String(jsDate.getDate()).padStart(2,'0');
      const month = String(jsDate.getMonth()+1).padStart(2,'0');
      const year = jsDate.getFullYear();
      return `${day}/${month}/${year}`;
    }

    let data = [];
    let filteredData = [];
    let currentPage = 1;
    const rowsPerPage = 10;

    const tbody = document.querySelector("#data-table tbody");
    const paginationDiv = document.getElementById("pagination");
    const searchInput = document.getElementById("search");

    function renderTable() {
      tbody.innerHTML = "";
      const start = (currentPage -1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = filteredData.slice(start, end);

      pageData.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.Dossard}</td>
          <td>${row.Nom}</td>
          <td>${row.Prenom}</td>
          <td>${row.Club}</td>
          <td>${formatExcelDate(row.Age)}</td>
          <td>${row.HF}</td>
          <td>${row.CAT}</td>
          <td>${row.Course}</td>
        `;
        tbody.appendChild(tr);
      });

      renderPagination();
    }

    function renderPagination() {
      paginationDiv.innerHTML = "";
      const pageCount = Math.ceil(filteredData.length / rowsPerPage);
      for(let i=1; i<=pageCount; i++){
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.disabled = (i === currentPage);
        btn.addEventListener("click", ()=> { currentPage=i; renderTable(); });
        paginationDiv.appendChild(btn);
      }
    }

    function sortByColumn(column) {
      filteredData.sort((a,b) => {
        if(a[column] < b[column]) return -1;
        if(a[column] > b[column]) return 1;
        return 0;
      });
      currentPage = 1;
      renderTable();
    }

    document.querySelectorAll("th").forEach(th => {
      th.addEventListener("click", ()=> sortByColumn(th.dataset.column));
    });

    searchInput.addEventListener("input", ()=>{
      const term = searchInput.value.toLowerCase();
      filteredData = data.filter(row => Object.values(row).some(val => String(val).toLowerCase().includes(term)));
      currentPage = 1;
      renderTable();
    });

    onValue(dbRef, (snapshot)=>{
      const val = snapshot.val();
      if(val){
        data = Object.values(val);
        filteredData = [...data];
        currentPage = 1;
        renderTable();
      }
    });
  </script>
</body>
</html>
