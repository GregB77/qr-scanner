<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Statistiques Participants</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; margin: 20px 0; width: 100%; max-width: 700px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
    caption { font-weight: bold; margin-bottom: 5px; }
    select { margin: 10px 0; padding: 5px; font-size: 1em; }
  </style>
</head>
<body>
  <h2>Statistiques des participants</h2>

  <label for="course-select">Choisir une course :</label>
  <select id="course-select">
    <option value="10km">10 km</option>
    <option value="20km">20 km</option>
  </select>

  <div id="pivot-table"></div>
  <div id="extremes-table"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // ðŸ”¹ Mets ici tes identifiants Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAIAAz51gEGKQd0EoqA3yUhvnqw3DkQiIo",
      authDomain: "calor-run.firebaseapp.com",
      databaseURL: "https://calor-run-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "calor-run",
      storageBucket: "calor-run.firebasestorage.app",
      messagingSenderId: "329949291334",
      appId: "1:329949291334:web:c71ef20268c609cf953b47",
      measurementId: "G-YVQPW6JGPK"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let participants = [];

    // RÃ©cupÃ©rer une seule fois les donnÃ©es
    db.ref("participants").once("value").then(snapshot => {
      participants = Object.values(snapshot.val() || {});
      renderTables("10km"); // affichage par dÃ©faut
    });

    document.getElementById("course-select").addEventListener("change", (e) => {
      renderTables(e.target.value);
    });

    function renderTables(course) {
      const pivotContainer = document.getElementById("pivot-table");
      const extremesContainer = document.getElementById("extremes-table");
      pivotContainer.innerHTML = "";
      extremesContainer.innerHTML = "";

      const filtered = participants.filter(p => p.course === course);
      if (filtered.length === 0) {
        pivotContainer.innerHTML = "<p>Aucun participant pour cette course.</p>";
        return;
      }

      const genres = ["H", "F"];
      const categories = [...new Set(filtered.map(p => p.cat))];

      // ðŸ”¹ Tableau pivotÃ©
      let tableHTML = `<table><caption>${course} â€“ RÃ©partition</caption><thead><tr><th>CatÃ©gorie</th>`;
      genres.forEach(g => tableHTML += `<th>${g}</th>`);
      tableHTML += `</tr></thead><tbody>`;
      categories.forEach(cat => {
        tableHTML += `<tr><td>${cat}</td>`;
        genres.forEach(g => {
          const count = filtered.filter(p => p.cat === cat && p.genre === g).length;
          tableHTML += `<td>${count}</td>`;
        });
        tableHTML += `</tr>`;
      });
      tableHTML += `</tbody></table>`;
      pivotContainer.innerHTML = tableHTML;

      // ðŸ”¹ Tableau extrÃªmes
      const sorted = [...filtered].sort((a, b) => a.age - b.age);
      const youngest = sorted[0];
      const oldest = sorted[sorted.length - 1];
      extremesContainer.innerHTML = `
        <table>
          <caption>${course} â€“ ExtrÃªmes</caption>
          <thead><tr><th>Type</th><th>Nom</th><th>PrÃ©nom</th><th>Ã‚ge</th><th>CatÃ©gorie</th><th>Genre</th></tr></thead>
          <tbody>
            <tr><td>Plus jeune</td><td>${youngest.nom}</td><td>${youngest.prenom}</td><td>${youngest.age}</td><td>${youngest.cat}</td><td>${youngest.genre}</td></tr>
            <tr><td>Plus Ã¢gÃ©</td><td>${oldest.nom}</td><td>${oldest.prenom}</td><td>${oldest.age}</td><td>${oldest.cat}</td><td>${oldest.genre}</td></tr>
          </tbody>
        </table>
      `;
    }
  </script>
</body>
</html>
