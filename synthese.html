<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Statistiques Participants</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; margin: 20px 0; width: 100%; max-width: 700px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
    caption { font-weight: bold; margin-bottom: 5px; }
  </style>
</head>
<body>
  <h2>Tableau pivot√© : Nombre de participants par genre et par cat√©gorie</h2>
  <div id="pivot-tables"></div>

  <h2>Participants le plus jeune et le plus √¢g√©</h2>
  <div id="extremes-tables"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // üîπ Config Firebase (√† remplacer par la tienne)
    const firebaseConfig = {
      apiKey: "XXX",
      authDomain: "XXX",
      databaseURL: "XXX",
      projectId: "XXX",
      storageBucket: "XXX",
      messagingSenderId: "XXX",
      appId: "XXX"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // üîπ R√©cup√©ration des participants
    db.ref("participants").once("value").then(snapshot => {
      const data = snapshot.val();
      const participants = Object.values(data || {});

      // Regrouper par course
      const courses = ["10km", "20km"];
      const genres = ["H", "F"]; // ajustable
      const pivotContainer = document.getElementById("pivot-tables");
      const extremesContainer = document.getElementById("extremes-tables");

      courses.forEach(course => {
        // Tableau pivot√©
        const filtered = participants.filter(p => p.course === course);
        const categories = [...new Set(filtered.map(p => p.cat))];
        let tableHTML = `<table><caption>${course}</caption><thead><tr><th>Cat√©gorie</th>`;
        genres.forEach(g => tableHTML += `<th>${g}</th>`);
        tableHTML += `</tr></thead><tbody>`;
        categories.forEach(cat => {
          tableHTML += `<tr><td>${cat}</td>`;
          genres.forEach(g => {
            const count = filtered.filter(p => p.cat === cat && p.genre === g).length;
            tableHTML += `<td>${count}</td>`;
          });
          tableHTML += `</tr>`;
        });
        tableHTML += `</tbody></table>`;
        pivotContainer.innerHTML += tableHTML;

        // Tableau extr√™mes (√¢ge)
        if (filtered.length > 0) {
          const sorted = filtered.sort((a,b) => a.age - b.age);
          const youngest = sorted[0];
          const oldest = sorted[sorted.length - 1];
          extremesContainer.innerHTML += `
            <table>
              <caption>${course}</caption>
              <thead><tr><th>Type</th><th>Nom</th><th>Pr√©nom</th><th>√Çge</th><th>Cat√©gorie</th><th>Genre</th></tr></thead>
              <tbody>
                <tr><td>Plus jeune</td><td>${youngest.nom}</td><td>${youngest.prenom}</td><td>${youngest.age}</td><td>${youngest.cat}</td><td>${youngest.genre}</td></tr>
                <tr><td>Plus √¢g√©</td><td>${oldest.nom}</td><td>${oldest.prenom}</td><td>${oldest.age}</td><td>${oldest.cat}</td><td>${oldest.genre}</td></tr>
              </tbody>
            </table>
          `;
        }
      });
    });
  </script>
</body>
</html>
